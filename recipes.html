
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Recipes &#8212; LFSBuilder  documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="License" href="license.html" />
    <link rel="prev" title="Configuration" href="configuration.html" />

  <link rel="stylesheet" href="_static/custom.css" type="text/css" />


  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">LFSBuilder</a></h1>



<p class="blurb">An automatic tool to build Linux from Scratch based distributions, or your own!</p>






<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">LFSBuilder</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="structure.html">Basic structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Recipes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#properties">Properties</a></li>
<li class="toctree-l2"><a class="reference internal" href="#functions">Functions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="whatsnext.html">What’s next</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="configuration.html" title="previous chapter">Configuration</a></li>
      <li>Next: <a href="license.html" title="next chapter">License</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">


          <div class="body" role="main">

  <div class="section" id="recipes">
<h1>Recipes<a class="headerlink" href="#recipes" title="Permalink to this headline">¶</a></h1>
<p>A <em>recipe</em> defines one of the basic component types of the LFSBuilder tool: <code class="docutils literal notranslate"><span class="pre">builders</span></code> and <code class="docutils literal notranslate"><span class="pre">components</span></code>. It is composed by a directory and a file both named after the component name. Apart from that, you can include a <code class="docutils literal notranslate"><span class="pre">functions.py</span></code> optional file that modify the way some core functions work with the component, or your own extra functions. As an example, under the <code class="docutils literal notranslate"><span class="pre">recipes/builders/toolchain</span></code> directory you can find the <code class="docutils literal notranslate"><span class="pre">toolchain.yaml</span></code> and <code class="docutils literal notranslate"><span class="pre">functions.py</span></code> files.</p>
<p>Recipes represent a customizable extra layer on top of the core functions of the LFSBuilder tool that allows you to customize your final system without the need of modifying its code. It also isolates issues because if a component is broken due to a bad configuration or function definition, it will only affect that component.</p>
<div class="section" id="properties">
<h2>Properties<a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">${component}.yaml</span></code> file is mandatory, and its minimum content is the <code class="docutils literal notranslate"><span class="pre">name</span></code> property. This attribute defines the value of several internal variables used by the LFSBuilder tool. You can also provide the <code class="docutils literal notranslate"><span class="pre">base_component</span></code> property to define the type of component you are defining. The options available for this property are:</p>
<ul class="simple">
<li><strong>SystemConfigurationComponent</strong>: this component type only modifies the final system in some way (generating files, directories, setting permissions…) but is not <em>built</em> using the compilation steps.</li>
<li><strong>CompilableComponent</strong>: this component is built using the <code class="docutils literal notranslate"><span class="pre">configure</span></code>/<code class="docutils literal notranslate"><span class="pre">make</span></code> tools.</li>
</ul>
<p>You can also define your own properties. They will be available at build time in the <code class="docutils literal notranslate"><span class="pre">component_data_dict</span></code> dictionary.</p>
<div class="section" id="available-properties">
<h3>Available properties<a class="headerlink" href="#available-properties" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><strong>package_name</strong>: name of the source code tarball file.</li>
<li><strong>previous</strong>: steps to be performed before starting the build process. Patches are applied before this step, right after uncompressing the source code.</li>
<li><strong>configure</strong>: commands to configure the component. It replaces the configure commands from the book.</li>
<li><strong>configure_options</strong>: extra options for the <code class="docutils literal notranslate"><span class="pre">configure</span></code> command. Added after books’ provided options.</li>
<li><strong>make</strong>: command that build the component. Usually <code class="docutils literal notranslate"><span class="pre">make</span></code>.</li>
<li><strong>make_options</strong>: extra options for the <code class="docutils literal notranslate"><span class="pre">make</span></code> command.</li>
<li><strong>install</strong>: command to run for installing the built libraries and binaries. Usually <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">install</span></code>.</li>
<li><strong>install_options</strong>: extra options for the previous command.</li>
<li><strong>test</strong>: commands to run instead of <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">test</span></code> or <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">check</span></code>.</li>
<li><strong>test_options</strong>: extra options for the previous command.</li>
<li><strong>include_tests</strong>: boolean parameter that enables/disables test execution.</li>
<li><strong>post</strong>: steps to be run after the build process.</li>
<li><strong>env_PATH_value</strong>: custom value for the <code class="docutils literal notranslate"><span class="pre">PATH</span></code> environment variable that will be used to build all the components that belong to a specific <code class="docutils literal notranslate"><span class="pre">builder</span></code>.</li>
<li><strong>book</strong>: the defined component belongs to that book. Valid values: <code class="docutils literal notranslate"><span class="pre">lfs</span></code>, <code class="docutils literal notranslate"><span class="pre">blfs</span></code> and <code class="docutils literal notranslate"><span class="pre">custom</span></code>.</li>
<li><strong>run_as_username</strong>: username that will build the component.</li>
<li><strong>run_into_chroot</strong>: whether a component should be build from inside the <code class="docutils literal notranslate"><span class="pre">chroot</span></code> or not.</li>
<li><strong>version</strong>: component version to build.</li>
<li><strong>comment_out_list</strong>: list of commands in the component’s XML files that will be commented out.</li>
<li><strong>components_to_build</strong>: ordered list of components to build for a desired builder if the <code class="docutils literal notranslate"><span class="pre">CUSTOM\_COMPONENTS\_TO\_BUILD</span></code> property is true.</li>
<li><strong>component_substitution_list</strong>: sustitutions to be performed in the component’s XML file.</li>
<li><strong>chapters_list</strong>: list of book chapters that include each build step of the Linux from Scratch book: <code class="docutils literal notranslate"><span class="pre">toolchain</span></code>, <code class="docutils literal notranslate"><span class="pre">system</span></code> and <code class="docutils literal notranslate"><span class="pre">configuration</span></code>.</li>
<li><strong>disable_commands_list</strong>: commands that will be ignored by the <code class="docutils literal notranslate"><span class="pre">LFSXmlParser</span></code> class, and therefore won be run.</li>
<li><strong>runscript_cmd</strong>: command used to run a compilation script.</li>
</ul>
</div>
</div>
<div class="section" id="functions">
<h2>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">functions.py</span></code> file allows you to customize the way some core functions interact with a component. As an example. the <code class="docutils literal notranslate"><span class="pre">kernel</span></code> component overwrites the <code class="docutils literal notranslate"><span class="pre">run_previous_steps</span></code> core function to, apart from running the core logic, copy the kernel configuration file that will be used to compile it. The content of the <code class="docutils literal notranslate"><span class="pre">functions.py</span></code> file for the <code class="docutils literal notranslate"><span class="pre">kernel</span></code> component is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">config</span>
<span class="kn">import</span> <span class="nn">tools</span>

<span class="k">def</span> <span class="nf">run_previous_steps</span><span class="p">(</span><span class="n">component_data_dict</span><span class="p">,</span> <span class="n">parent_function</span><span class="p">):</span>

    <span class="c1"># Call parent function</span>
    <span class="n">parent_function</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Copying custom </span><span class="se">\&#39;</span><span class="s2">.config</span><span class="se">\&#39;</span><span class="s2"> file&quot;</span><span class="p">)</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">component_data_dict</span><span class="p">[</span><span class="s2">&quot;lfsbuilder_src_directory&quot;</span><span class="p">],</span>
                            <span class="s2">&quot;recipes&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;components&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;kernel&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;files&quot;</span><span class="p">,</span>
                            <span class="n">component_data_dict</span><span class="p">[</span><span class="s2">&quot;kernel_config_filename&quot;</span><span class="p">])</span>

    <span class="n">tools</span><span class="o">.</span><span class="n">copy_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">component_data_dict</span><span class="p">[</span><span class="s2">&quot;extracted_directory&quot;</span><span class="p">],</span> <span class="s2">&quot;.config&quot;</span><span class="p">)</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>As shown above, that component defines the <code class="docutils literal notranslate"><span class="pre">kernel_config_filename</span></code> custom property, which contains the name of the configuration file to be used. All the functions that can be overwritten always receive the same parameters:</p>
<ul class="simple">
<li><strong>component_data_dict</strong>: a Python dictionary with the current values of the component metadata (name, version, commands to run…). You can modify these values from a custom function.</li>
<li><strong>parent_function</strong>: references the core function that is being overwriten. From a <em>object oriented programming</em> point of view, it allows you to run the <code class="docutils literal notranslate"><span class="pre">super</span></code> class function.</li>
</ul>
<p>The list of the core functions that can be customized is present below</p>
<div class="section" id="available-functions">
<h3>Available functions<a class="headerlink" href="#available-functions" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><strong>apply_patches</strong>: looks and apply a source code patch.</li>
<li><strong>build</strong>: required steps to build components of a specific builder.</li>
<li><strong>extract_source_code</strong>: defines how a source code tarball is extracted.</li>
<li><strong>get_components_to_build_list</strong>: returns the list of components that a specific builder builds. This function can be used to modify that list, for example depending on the value of a configuration property.</li>
<li><strong>modify_xmlfile</strong>: modifies a component or builder XML file before parsing it.</li>
<li><strong>run_post_steps</strong>: steps to run after a component is build and installed.</li>
<li><strong>run_previous_steps</strong>: steps run right after extracting the component source code and before starting the build process.</li>
<li><strong>set_attributes</strong>: allows you to modify the component attributes before starting the build process.</li>
</ul>
</div>
</div>
</div>


          </div>

        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2019, Gonzalo Gómez Gracia.

      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>

      |
      <a href="_sources/recipes.md.txt"
          rel="nofollow">Page source</a>
    </div>




  </body>
</html>
