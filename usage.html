
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Usage &#8212; LFSBuilder  documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Basic structure" href="structure.html" />
    <link rel="prev" title="Installation" href="installation.html" />

  <link rel="stylesheet" href="_static/custom.css" type="text/css" />


  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">LFSBuilder</a></h1>



<p class="blurb">An automatic tool to build Linux from Scratch based distributions, or your own!</p>






<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">LFSBuilder</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#downloading-books-source-files-and-components-source-code">Downloading books source files and components source code</a></li>
<li class="toctree-l2"><a class="reference internal" href="#parsing-xml-files">Parsing XML files</a></li>
<li class="toctree-l2"><a class="reference internal" href="#building">Building</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="structure.html">Basic structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="recipes.html">Recipes</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="whatsnext.html">What’s next</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="installation.html" title="previous chapter">Installation</a></li>
      <li>Next: <a href="structure.html" title="next chapter">Basic structure</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">


          <div class="body" role="main">

  <div class="section" id="usage">
<h1>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h1>
<p>LFSBuilder requires Python 3.x to be run. The Python 2.x versions support has been dropped as its <a class="reference external" href="https://www.python.org/dev/peps/pep-0373/#update">end of life date</a> is just around the corner. Once the required dependencies are installed you can start using it.</p>
<p>The main configuration file is the <code class="docutils literal notranslate"><span class="pre">config.py</span></code> file located in the main directory of the program. In this file you customize the behaviour of the program, such as where will the chroot be located, which version of Linux from Scratch you want to build, and others. Some of those options have an equivalent command line option that will overwrite the value of the parameter in that config file. If you are not familiar with the Linux/UNIX command line and the source code compilation process, it is recommended to use the default values in the file.</p>
<p>From now on, this text will suppose that you have satisffied the requirements of both projects, Linux from Scratch and LFSBuilder, and also has a correct <code class="docutils literal notranslate"><span class="pre">config.py</span></code> file. You can run the next unit test to check it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span> <span class="o">-</span><span class="n">B</span> <span class="o">-</span><span class="n">m</span> <span class="n">unittest</span> <span class="o">-</span><span class="n">f</span> <span class="n">tests</span><span class="o">/</span><span class="n">test_config</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>The help message of the LFSBuilder command line interface is shown below for further reference:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python3 -B lfsbuilder.py --help
usage: lfsbuilder.py [-h] [-v] [--debug-scripts]
                     [--base-directory BASE_DIRECTORY]
                     [--non-privileged-username NON_PRIVILEGED_USERNAME]
                     [--sources-orig-directory SOURCES_ORIG_DIRECTORY]
                     [--makeflags MAKEFLAGS]
                     [--restore-xml-backups RESTORE_XML_BACKUPS]
                     [--lfs-version LFS_VERSION]
                     ...

positional arguments:
  {build,download,parse}
                        Subcommand to run

optional arguments:
  -h, --help            show this help message and exit
  -v, --verbose         Output verbose messages
  --debug-scripts       Debug scripts when running
  --base-directory BASE_DIRECTORY
                        Set base directory
  --non-privileged-username NON_PRIVILEGED_USERNAME
                        Set non privileged username
  --sources-orig-directory SOURCES_ORIG_DIRECTORY
                        Set origin directory for sources
  --makeflags MAKEFLAGS
                        Set MAKEFLAGS value
  --restore-xml-backups RESTORE_XML_BACKUPS
                        Restore XML backups files
  --lfs-version LFS_VERSION
                        Version of the book
</pre></div>
</div>
<p>The main actions you can do with LFSBuilder are explained next:</p>
<ul class="simple">
<li><em>Download</em> books’ source files and source code.</li>
<li><em>Parse</em> book’s XML files.</li>
<li><em>Build</em> one or multiple builders.</li>
</ul>
<div class="section" id="downloading-books-source-files-and-components-source-code">
<h2>Downloading books source files and components source code<a class="headerlink" href="#downloading-books-source-files-and-components-source-code" title="Permalink to this headline">¶</a></h2>
<p>The LFSBuilder tool can download the XML files for the Linux from Scratch and Beyond Linux from Scratch versions that will be build. To do so, use the <code class="docutils literal notranslate"><span class="pre">download</span></code> command with the <code class="docutils literal notranslate"><span class="pre">lfsbuilder.py</span></code> main script from the LFSBuilder main directory. For example. to download the XML files for the Linux from Scratch book, you run</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span> <span class="o">-</span><span class="n">B</span> <span class="n">lfsbuilder</span><span class="o">.</span><span class="n">py</span> <span class="n">download</span> <span class="o">--</span><span class="n">xml</span> <span class="n">lfs</span>
</pre></div>
</div>
<p>The command above will download the LFS book for the version set in the <code class="docutils literal notranslate"><span class="pre">LFS_VERSION</span></code> parameter of the <code class="docutils literal notranslate"><span class="pre">config.py</span></code> file. If you want to download a different version than the one in the config file, you can use the <code class="docutils literal notranslate"><span class="pre">--lfs-version</span></code> command line parameter that overwrites the mentioned parameter at run time:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span> <span class="o">-</span><span class="n">B</span> <span class="n">lfsbuilder</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">lfs</span><span class="o">-</span><span class="n">version</span> <span class="mf">7.9</span> <span class="n">download</span> <span class="o">--</span><span class="n">xml</span> <span class="n">lfs</span>
</pre></div>
</div>
<p>You can check the downloaded version under the <code class="docutils literal notranslate"><span class="pre">/tmp/lfs/general.ent</span></code> file running the command below</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">grep</span> <span class="s2">&quot;ENTITY version&quot;</span> <span class="o">./</span><span class="n">tmp</span><span class="o">/</span><span class="n">lfs</span><span class="o">/</span><span class="n">general</span><span class="o">.</span><span class="n">ent</span>
</pre></div>
</div>
<p>Downloading the source code for a book’s list of components is also possible. To do that, you need to specify the <code class="docutils literal notranslate"><span class="pre">--source</span></code> selector to the <code class="docutils literal notranslate"><span class="pre">download</span></code> command instead of <code class="docutils literal notranslate"><span class="pre">--xml</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span> <span class="o">-</span><span class="n">B</span> <span class="n">lfsbuilder</span><span class="o">.</span><span class="n">py</span> <span class="n">download</span> <span class="o">--</span><span class="n">source</span> <span class="n">blfs</span>
</pre></div>
</div>
<blockquote>
<div><div class="warning-quote"> NOTE: it is required to download book's XML files before downloading the source code packages. </div></div></blockquote>
</div>
<div class="section" id="parsing-xml-files">
<h2>Parsing XML files<a class="headerlink" href="#parsing-xml-files" title="Permalink to this headline">¶</a></h2>
<p>For both books, the Linux from Scratch and Beyond Linux from Scratch, the LFSBuilder tool parses the XML files into a single XML file with all the metadata and required commands to build each component. With that, LFSBuilder concentrate all the information for each step (that is, from one or more book chapters), into one single file. The result XML file is later imported into LFSBuilder to build the required components.</p>
<p>To parse a single builder of the Linux from Scratch book (either <code class="docutils literal notranslate"><span class="pre">toolchain</span></code>, <code class="docutils literal notranslate"><span class="pre">system</span></code> or <code class="docutils literal notranslate"><span class="pre">configuration</span></code>), the next command should be executed into the main LFSBuilder directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span> <span class="o">-</span><span class="n">B</span> <span class="n">lfsbuilder</span><span class="o">.</span><span class="n">py</span> <span class="n">parse</span> <span class="n">toolchain</span>
</pre></div>
</div>
<blockquote>
<div><strong>NOTE</strong>: The command above can receive a space-separated list of builders to parse</div></blockquote>
<p>It is also possible to parse all the three parts of the Linux From Scratch book without specifying them but using the special name <code class="docutils literal notranslate"><span class="pre">lfs</span></code>. This alias also works for the build step.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span> <span class="o">-</span><span class="n">B</span> <span class="n">lfsbuilder</span><span class="o">.</span><span class="n">py</span> <span class="n">parse</span> <span class="n">lfs</span>
</pre></div>
</div>
</div>
<div class="section" id="building">
<h2>Building<a class="headerlink" href="#building" title="Permalink to this headline">¶</a></h2>
<p>The build command is aim to build the different components that are part of a specific builder. This command is required to be run as the <strong>root</strong> user (use <code class="docutils literal notranslate"><span class="pre">sudo</span></code> to achieve that from a regular user) as it requires access to privileged commands in your system such as <code class="docutils literal notranslate"><span class="pre">mount</span></code>, <code class="docutils literal notranslate"><span class="pre">chroot</span></code>, <code class="docutils literal notranslate"><span class="pre">mkfs</span></code> and others.</p>
<p>The LFSBuilder utility runs the build process inside a chrooted directory, so it is isolated from the rest of the system. Also, by default it creates a <code class="docutils literal notranslate"><span class="pre">.img</span></code> file into the <code class="docutils literal notranslate"><span class="pre">tmp</span></code> directory inside the LFSBuilder main folder that is then mounted on your system. Once the build process has finished, you can convert the <code class="docutils literal notranslate"><span class="pre">.img</span></code> file to the <a class="reference external" href="https://en.wikipedia.org/wiki/VMDK">VMDK virtual machine format</a> or any other virtual machine format so you can test your new system.</p>
<p>To build the Linux from Scratch book, it is necessary to run a command similar to this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">python3</span> <span class="o">-</span><span class="n">B</span> <span class="n">lfsbuilder</span><span class="o">.</span><span class="n">py</span> <span class="n">build</span> <span class="n">lfs</span>
</pre></div>
</div>
<p>You can add many arguments to the command above that will tune the build. You can set the base directory, the init system (<code class="docutils literal notranslate"><span class="pre">sysv</span></code> or <code class="docutils literal notranslate"><span class="pre">systemd</span></code>), and others. These options have higher preferences than the values in the <code class="docutils literal notranslate"><span class="pre">config.py</span></code> file. The latest argument of the build command is an ordered list of builders. This list will be checked and modify according to the next points:</p>
<ul class="simple">
<li>Duplicates builders are forbidden.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">provider</span></code> and <code class="docutils literal notranslate"><span class="pre">collector</span></code> builders will be added automatically at the beginning and the end of the list respectively. Those special builders take care of prepare and clean the build environment.</li>
<li>The Linux from Scratch book’s builders must be built on its prefixed order: <code class="docutils literal notranslate"><span class="pre">toolchain</span></code>, <code class="docutils literal notranslate"><span class="pre">system</span></code> and <code class="docutils literal notranslate"><span class="pre">configuration</span></code>. You can run them in a different order if you only build one builder at a time, but <strong>you are highly advised to not to do it</strong>.</li>
<li>You can include your own builders in any position as long as you keep the order:<ul>
<li><code class="docutils literal notranslate"><span class="pre">toolchain</span></code> must be the first of the three of them.</li>
<li><code class="docutils literal notranslate"><span class="pre">system</span></code> must be built before <code class="docutils literal notranslate"><span class="pre">configuration</span></code>.</li>
</ul>
</li>
</ul>
<p>With all the previous information, the next command will run a build that generates a <code class="docutils literal notranslate"><span class="pre">.img</span></code> file, mounts it in your system, will mount the required system directories into the chroot and the downloaded sources files as well for the build process to be able to find them. It will also build the <code class="docutils literal notranslate"><span class="pre">systemd</span></code> version of the Linux from Scratch and the Beyond Linux from Scratch books and another different custom builder called <code class="docutils literal notranslate"><span class="pre">mybuilder</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">python3</span> <span class="o">-</span><span class="n">B</span> <span class="n">lfsbuilder</span><span class="o">.</span><span class="n">py</span> <span class="n">build</span> \
    <span class="o">--</span><span class="n">generate</span><span class="o">-</span><span class="n">img</span><span class="o">-</span><span class="n">file</span> <span class="o">--</span><span class="n">mount</span><span class="o">-</span><span class="n">img</span><span class="o">-</span><span class="n">file</span> \
    <span class="o">--</span><span class="n">mount</span><span class="o">-</span><span class="n">system</span><span class="o">-</span><span class="n">directories</span> <span class="o">--</span><span class="n">mount</span><span class="o">-</span><span class="n">sources</span> \
    <span class="o">--</span><span class="n">systemd</span> <span class="n">lfs</span> <span class="n">blfs</span> <span class="n">mybuilder</span>
</pre></div>
</div>
<p>In case you find any issue building one of the components of a builder, you can restart the build process from that component directly instead of building all the components of the builders using the special argument <code class="docutils literal notranslate"><span class="pre">--continue-at</span></code>. For example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">python3</span> <span class="o">-</span><span class="n">B</span> <span class="n">lfsbuilder</span><span class="o">.</span><span class="n">py</span> <span class="n">build</span> \
    <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">generate</span><span class="o">-</span><span class="n">img</span><span class="o">-</span><span class="n">file</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">mount</span><span class="o">-</span><span class="n">img</span><span class="o">-</span><span class="n">file</span> \
    <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">mount</span><span class="o">-</span><span class="n">system</span><span class="o">-</span><span class="n">directories</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">mount</span><span class="o">-</span><span class="n">sources</span> \
    <span class="o">--</span><span class="k">continue</span><span class="o">-</span><span class="n">at</span><span class="o">=</span><span class="n">failed</span><span class="o">-</span><span class="n">component</span> <span class="n">mybuilder</span>
</pre></div>
</div>
<blockquote>
<div><strong>NOTE</strong>: the <code class="docutils literal notranslate"><span class="pre">--continue-at</span></code> parameter will only work for a component present in the first builder of the given list.</div></blockquote>
</div>
</div>


          </div>

        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2019, Gonzalo Gómez Gracia.

      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>

      |
      <a href="_sources/usage.md.txt"
          rel="nofollow">Page source</a>
    </div>




  </body>
</html>
